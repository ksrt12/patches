From bb7c4cd27bdc072237cd300fd7351e0103ed76a5 Mon Sep 17 00:00:00 2001
From: Kazakov Stepan <ksrt12group@gmail.com>
Date: Tue, 22 Jan 2019 13:15:01 +0300
Subject: [PATCH 06/11] fix answer from home key

Signed-off-by: Kazakov Stepan <ksrt12group@gmail.com>
---
 .../android/server/policy/PhoneWindowManager.java  | 14 +++++++-------
 1 file changed, 7 insertions(+), 7 deletions(-)

diff --git a/services/core/java/com/android/server/policy/PhoneWindowManager.java b/services/core/java/com/android/server/policy/PhoneWindowManager.java
index 16ea027c68fb..990796f19df5 100644
--- a/services/core/java/com/android/server/policy/PhoneWindowManager.java
+++ b/services/core/java/com/android/server/policy/PhoneWindowManager.java
@@ -3414,7 +3414,7 @@ public class PhoneWindowManager implements WindowManagerPolicy {
             }
 
             mIncallHomeBehavior = (Settings.System.getIntForUser(resolver,
-                    Settings.System.ALLOW_INCALL_HOME, 1, UserHandle.USER_CURRENT) == 1);
+                    Settings.System.ALLOW_INCALL_HOME, 0, UserHandle.USER_CURRENT) == 1);
 
 
             mUseGestureButton = Settings.System.getIntForUser(resolver,
@@ -4693,12 +4693,12 @@ public class PhoneWindowManager implements WindowManagerPolicy {
                     return -1;
                 }
 
-                // If an incoming call is ringing and mIncallHomeBehavior=false, HOME is totally disabled.
-                TelecomManager telecomManager = getTelecommService();
-                if (telecomManager != null && telecomManager.isRinging()
-                        && !mIncallHomeBehavior) {
-                      Log.i(TAG, "Ignoring HOME; there's a ringing incoming call.");
-                      return -1;
+                if (mIncallHomeBehavior) {
+                    final TelecomManager telecomManager = getTelecommService();
+                    if (telecomManager != null && telecomManager.isRinging()) {
+                        telecomManager.acceptRingingCall();
+                        return -1;
+                    }
                 }
 
                 // Delay handling home if a double-tap is possible.
-- 
2.20.1

